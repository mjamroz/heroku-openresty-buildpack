#!/usr/bin/env bash
set -euo pipefail

OPENRESTY_DIR="$HOME/openresty"
OPENRESTY_BIN="$OPENRESTY_DIR/nginx/sbin/nginx"
NGINX_CONF_DIR="$OPENRESTY_DIR/nginx/conf"
NGINX_DIR="$OPENRESTY_DIR/nginx"
SOURCE_NGINX_CONF="$NGINX_CONF_DIR/nginx.conf.default"
DEST_NGINX_CONF="$NGINX_CONF_DIR/nginx.conf"

# If there's an nginx.conf in the root of the project directory
# then it will be used instead of the default nginx.conf
if [[ -f "$HOME/nginx.conf" ]]; then
  SOURCE_NGINX_CONF="$HOME/nginx.conf"
fi


exec "$OPENRESTY_BIN" -p "&NGINX_DIR"  -c "$DEST_NGINX_CONF"
